1. Фоновые задачи, это когда клиент тут же получает ответ, что мы приняли фоновую задачу,
она находится в обработке, и как только у нас будет мощность, мы тут же ее исполним.
2. Для того, чтобы отправлять письма на почту, нам необходимо зарегистрировать некоторое
приложение.
3. Заходим в гугл аккаунт и в настройках включаем двухфакторную аутентификацию.
4. Заходим в пароли и приложения и создаем приложения. пароль сохраняем в надежном месте.
5. Нам понадобится 2 библиотеки: Celery и Flower
6. Celery нам позволяет делать фоновые задачи, отложенные задачи.
Создаем директорию tasks и в ней 2 файла: router.py & tasks.py
7. В task.py заполняем данные о почте, портах и пользователе.
8. Чтобы запустить, у нас есть отдельный файл router.py в папке tasks. В нем прописывает эндпоинт
и импортируем нужные библиотеки.
9. Для запуска celery и flower нужно открыть отдельный терминал (отдельный питон-процесс)
celery -A tasks.tasks:celery worker --loglevel=INFO --pool=solo
worker - принимает задачи и тут же их выполняет, если работаем на windows обязательно прописать pool#solo
10. Не забыть в config.py прописать SMT_PASSWORD, SMT_USER
11. Теперь запустим web-interface для удобства мониторинга этих задач:
celery -A tasks.tasks:celery flower
12. Чтобы запустить это на fastapi, нужно прописать 1 строчку кода:
внутри функции в файле router.py создаем переменную, и используем класс BackgroundTasks.